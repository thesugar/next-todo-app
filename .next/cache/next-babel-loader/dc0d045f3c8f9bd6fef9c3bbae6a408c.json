{"ast":null,"code":"import _Object$assign from \"@babel/runtime-corejs2/core-js/object/assign\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/Users/thesugar/next-todo-app/components/Address.js\";\nvar __jsx = React.createElement;\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport Router from 'next/router';\nimport firebase from \"firebase\";\nimport Lib from '../static/address_lib';\nimport Account from '../components/Account';\nimport Link from 'next/link';\n\nvar Address =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Address, _Component);\n\n  _createClass(Address, null, [{\n    key: \"getInitialProps\",\n    value: function getInitialProps(_ref) {\n      var reduxStore = _ref.reduxStore,\n          req = _ref.req;\n      var isServer = !!req; // DISPATCH ACTIONS HERE ONLY WITH `reduxStore.dispatch`\n\n      reduxStore.dispatch(serverRenderClock(isServer));\n      return {};\n    }\n  }]);\n\n  function Address(props) {\n    var _this;\n\n    _classCallCheck(this, Address);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Address).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"style\", {\n      fontSize: \"12pt\",\n      padding: \"5px 10px\"\n    });\n\n    _this.logined = _this.logined.bind(_assertThisInitialized(_this));\n    return _this;\n  } // login, logout 処理\n\n\n  _createClass(Address, [{\n    key: \"logined\",\n    value: function logined() {\n      this.getFireData();\n    }\n  }, {\n    key: \"logouted\",\n    value: function logouted() {\n      Router.push('/address');\n    } // get data from Firebase\n\n  }, {\n    key: \"getFireData\",\n    value: function getFireData() {\n      if (firebase.auth().currentUser == undefined || firebase.auth().currentUser == null) {\n        return;\n      }\n\n      var db = firebase.firestore(); // firestore のオブジェクト取得\n\n      var ref = db.collection('tasks');\n      var self = this;\n      ref.get().then(function (querySnapshot) {\n        var ids = [];\n        var d = [];\n        var taskdoc = {};\n        querySnapshot.forEach(function (doc, index, querySnapshot) {\n          // doc.data() is never undefined for query doc snapshots\n          console.log(doc.id, \" => \", doc.data()); //d.push(Lib.deepCopy(doc.data()));\n          //ids.push(doc.id);\n\n          taskdoc = _Object$assign(taskdoc, _defineProperty({}, doc.id, Lib.deepCopy(doc.data()))); // d.push してるのにループのたびにdispatchしてるから無駄な部分はある\n          // forEach の中で querySnapshot の length が取得できればいいが、、\n\n          self.props.dispatch({\n            type: 'UPDATE_USER',\n            value: {\n              login: self.props.login,\n              username: self.props.username,\n              email: self.props.email,\n              taskData: taskdoc,\n              //docid : ids,\n              //data: d,\n              items: self.getItem(taskdoc)\n            }\n          });\n        });\n      });\n    } // data を元に表示項目を作成\n\n  }, {\n    key: \"getItem\",\n    value: function getItem(taskdoc) {\n      //console.log('data is');\n      //console.log(data);\n      if (taskdoc == undefined) {\n        return;\n      }\n\n      var res = [];\n\n      for (var key in taskdoc) {\n        res.push(__jsx(\"li\", {\n          key: key,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 87\n          },\n          __self: this\n        }, __jsx(Link, {\n          href: \"/p/[id]\",\n          as: \"/p/\".concat(key),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 88\n          },\n          __self: this\n        }, __jsx(\"a\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 89\n          },\n          __self: this\n        }, taskdoc[key]['title'])), __jsx(\"ul\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 91\n          },\n          __self: this\n        }, __jsx(\"li\", {\n          key: 1,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 92\n          },\n          __self: this\n        }, taskdoc[key]['detail']), __jsx(\"li\", {\n          key: 2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 93\n          },\n          __self: this\n        }, new Date(taskdoc[key]['deadline'].seconds * 1000).toLocaleDateString()))));\n      }\n\n      return res;\n    } // データ表示ページの移動\n\n  }, {\n    key: \"go\",\n    value: function go(email) {\n      Router.push('/address_show?email=' + email);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return __jsx(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 107\n        },\n        __self: this\n      }, __jsx(Account, {\n        onLogined: this.logined,\n        onLogouted: this.logouted,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 108\n        },\n        __self: this\n      }), __jsx(\"ul\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 110\n        },\n        __self: this\n      }, this.props.items.length === 0 || this.props.items === undefined || this.props.items === null ? __jsx(\"li\", {\n        key: \"0\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 113\n        },\n        __self: this\n      }, \"no item.\") : this.props.items));\n    }\n  }]);\n\n  return Address;\n}(Component);\n\nAddress = connect(function (state) {\n  return state;\n})(Address);\nexport default Address;","map":{"version":3,"sources":["/Users/thesugar/next-todo-app/components/Address.js"],"names":["React","Component","connect","Router","firebase","Lib","Account","Link","Address","reduxStore","req","isServer","dispatch","serverRenderClock","props","fontSize","padding","logined","bind","getFireData","push","auth","currentUser","undefined","db","firestore","ref","collection","self","get","then","querySnapshot","ids","d","taskdoc","forEach","doc","index","console","log","id","data","deepCopy","type","value","login","username","email","taskData","items","getItem","res","key","Date","seconds","toLocaleDateString","logouted","length","state"],"mappings":"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","sourcesContent":["import React, {Component} from 'react';\nimport {connect} from 'react-redux';\nimport Router from 'next/router';\nimport firebase from \"firebase\";\nimport Lib from '../static/address_lib';\nimport Account from '../components/Account';\nimport Link from 'next/link';\n\nclass Address extends Component {\n    static getInitialProps({ reduxStore, req }) {\n        const isServer = !!req\n        // DISPATCH ACTIONS HERE ONLY WITH `reduxStore.dispatch`\n        reduxStore.dispatch(serverRenderClock(isServer))\n    \n        return {}\n      }\n\n    style = {\n        fontSize: \"12pt\",\n        padding: \"5px 10px\"\n    }\n\n    constructor(props){\n        super(props);\n        this.logined = this.logined.bind(this);\n    }\n\n    // login, logout 処理\n    logined(){\n        this.getFireData();\n    }\n\n    logouted(){\n        Router.push('/address');\n    }\n\n    // get data from Firebase\n    getFireData() {\n        if (firebase.auth().currentUser == undefined ||\n            firebase.auth().currentUser == null) { return;}\n\n        let db = firebase.firestore(); // firestore のオブジェクト取得\n    \n        let ref = db.collection('tasks');\n        let self = this;\n        ref.get()\n        .then(function(querySnapshot) {\n            let ids = [];\n            let d = [];\n            let taskdoc = {};\n\n            querySnapshot.forEach((doc, index, querySnapshot) => {\n            // doc.data() is never undefined for query doc snapshots\n            console.log(doc.id, \" => \", doc.data());\n            //d.push(Lib.deepCopy(doc.data()));\n            //ids.push(doc.id);\n\n            taskdoc = Object.assign(taskdoc, {[doc.id] : Lib.deepCopy(doc.data())})\n            // d.push してるのにループのたびにdispatchしてるから無駄な部分はある\n            // forEach の中で querySnapshot の length が取得できればいいが、、\n            self.props.dispatch({\n                type: 'UPDATE_USER',\n                value: {\n                    login: self.props.login,\n                    username: self.props.username,\n                    email: self.props.email,\n                    taskData : taskdoc,\n                    //docid : ids,\n                    //data: d,\n                    items: self.getItem(taskdoc)\n                    }\n            })\n            \n        })\n        \n        });\n    }\n\n    // data を元に表示項目を作成\n    getItem(taskdoc) {\n\n        //console.log('data is');\n        //console.log(data);\n        if (taskdoc == undefined) {return;}\n        let res = [];\n        for (let key in taskdoc){\n        res.push(<li key={key}>\n                <Link href=\"/p/[id]\" as={`/p/${key}`}>\n                    <a>{taskdoc[key]['title']}</a>\n                 </Link>\n                    <ul>\n                        <li key={1}>{taskdoc[key]['detail']}</li>\n                        <li key={2}>{new Date(taskdoc[key]['deadline'].seconds * 1000).toLocaleDateString()}</li>\n                    </ul>\n                </li>);\n        }\n        return res;\n    }\n    \n    // データ表示ページの移動\n    go(email){\n        Router.push('/address_show?email=' + email);\n    }\n\n    render(){\n        return (\n            <div>\n                <Account onLogined={this.logined}\n                 onLogouted={this.logouted} />\n                <ul>\n                    {this.props.items.length === 0 || this.props.items === undefined || this.props.items === null\n                    ?\n                    <li key=\"0\">no item.</li>\n                    :\n                    this.props.items\n                    }\n                </ul>\n            </div>\n        )\n    }\n}\n\nAddress = connect((state) => state)(Address);\nexport default Address;"]},"metadata":{},"sourceType":"module"}